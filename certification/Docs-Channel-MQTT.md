# AliOS Things MQTT通道测试规范
* [AOS-3-16 设备认证](#设备认证)
* [AOS-3-17 MQTT通道连接](#MQTT通道连接)
* [AOS-3-18 设备订阅topic](#设备订阅topic)
* [AOS-3-19 设备发布topic](#设备发布topic)
* [AOS-3-20 设备心跳](#设备心跳)
* [AOS-3-21 设备反复认证与连接](#设备反复认证与连接)
* [AOS-3-22 设备长时间稳定通信](#设备长时间稳定通信)
* [AOS-3-23 大数据包稳定通信](#大数据包稳定通信)
* [AOS-3-24 断网发现](#断网发现)
* [AOS-3-25 长时间断网后重连](#长时间断网后重连)
* [AOS-3-26 反复建立连接和断开连接](#反复建立连接和断开连接)

自测帮助详见 [AliOS Things MQTT 通道自测指南](https://github.com/alibaba/AliOS-Things/wiki/Manual-Channel-MQTT)


### 设备认证
---
**用例编号**：AOS-3-16

**用例名称**：设备认证

**测试目的**：验证设备认证后获取iotid与iottoken

**用例属性**：功能

**测试步骤**：

设备尝试通过HTTPS/MQTT/ID2认证 

**预期结果**：

1.设备所支持的认证方式认证通过，拿到iotid和iottoken并且成功连接MQTT服务器

2.系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常

**备注**：
认证方式有HTTPS认证/MQTT直连认证/ID2认证，设备可选支持其中一种或多种


### MQTT通道连接
---
**用例编号**：AOS-3-17

**用例名称**：MQTT通道连接

**测试目的**：验证设备连接MQTT服务器

**用例属性**：功能

**测试步骤**：

1.设备连接设备MQTT服务

**预期结果**：

1.设备连接MQTT服务成功，设备状态变为在线

2.系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常

**备注**：


### 设备订阅topic
---
**用例编号**：AOS-3-18

**用例名称**：设备订阅topic

**测试目的**：验证设备连接成功后订阅topic的能力

**用例属性**：功能

**测试步骤**：

1.设备订阅topic A，保持在线状态 

2.web页面向该设备的topic A 发布一条消息

**预期结果**：

1.设备接收到topic A的一条消息并且消息内容与页面填写的内容相同

2.系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常

**备注**：

### 设备发布topic
---
**用例编号**：AOS-3-19

**用例名称**：设备发布topic 

**测试目的**：验证设备连接成功后主动发布topic的能力 

**用例属性**：功能

**测试步骤**：

1.设备向topic A发布一条消息 

2.web页面向该设备的topic A 发布一条消息

**预期结果**：

1.设备发布消息成功，服务日志查询的消息内容与设备发布的消息内容相同

2.系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常

**备注**：

### 设备心跳
---
**用例编号**：AOS-3-20

**用例名称**：设备心跳

**测试目的**：验证设备保持在线心跳机制完备

**用例属性**：功能

**测试步骤**：

1.设备以心跳为周期向MQTT服务器发送心跳包持续3小时

2.观察云端设备在线状态

**预期结果**：

1.设备3小时无离线

2.系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常

**备注**：

### 设备反复认证与连接
---
**用例编号**：AOS-3-21

**用例名称**：设备反复认证与连接

**测试目的**：验证设备反复认证与连接稳定性

**用例属性**：功能

**测试步骤**：

1.设备认证 

2.认证成功后，设备建立MQTT连接 

3.设备断开MQTT连接 

4.步骤1~3重复1000次

**预期结果**：

1.认证与建立连接成功率99.9% 

2.系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常

**备注**：

### 设备长时间稳定通信
---
**用例编号**：AOS-3-22

**用例名称**：设备长时间稳定通信

**测试目的**：验证设备长时间工作稳定且高频数据通信稳定

**用例属性**：功能

**测试步骤**：
1.设备认证连接，并保持在线状态 

2.设备订阅topic A，在topic A回调函数中将接收到的消息转发到topic B 

3.使用压测工具以500ms周期向topic A发送消息，并统计topic B消息数量

**预期结果**：

1.3x24小时稳定工作，无离线 

2.成功率≥99.5% 

3.系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常

**备注**：

压测工具及使用见[AliOS Things MQTT 通道自测指南](https://github.com/alibaba/AliOS-Things/wiki/Manual-Channel-MQTT)


### 大数据包稳定通信
---
**用例编号**：AOS-3-23

**用例名称**：验证设备大数据包稳定通信

**测试目的**：验证设备大数据包稳定通信

**用例属性**：稳定性

**测试步骤**：

1.设备认证连接，并保持在线状态

2.设备订阅topic A，在topic A回调函数中将接收到的消息转发到topic B

3.使用压测工具以1秒周期向topic A发送32KB payload，并统计topic B消息数量

**预期结果**：

1.1小时稳定工作 

2.丢包率≤0.5% 

3.重连次数≤1次 

4.系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常

**备注**：

1.压测工具及使用见[AliOS Things MQTT 通道自测指南](https://github.com/alibaba/AliOS-Things/wiki/Manual-Channel-MQTT)

2.32KB payload可以根据设备实际能力调整


### 断网发现
---
**用例编号**：AOS-3-24

**用例名称**：断网发现

**测试目的**：验证设备在网络断开后能发现网络异常

**用例属性**：稳定性

**测试步骤**：

1.设备认证连接，并保持在线状态（维持心跳）

2.待连接稳定后，断开网络（断AP WAN口）

3.查看设备端日志

**预期结果**：

1.网络断开后设备能发现并断开MQTT连接

2.发现断网时间≤3个心跳周期（默认心跳周期为1分钟） 

**备注**：

### 长时间断网后重连
---
**用例编号**：AOS-3-25

**用例名称**：长时间断网后重连

**测试目的**：验证设备在长时间断开连接后能恢复连接

**用例属性**：稳定性

**测试步骤**：

1.设备认证连接，并保持在线状态（维持心跳）

2.待连接稳定后，断开网络（断AP WAN口）

3.1小时后恢复网络（恢复AP WAN口连接）

4.观察设备上线记录

**预期结果**：

1.网络恢复后设备能够再次上线，时间间隔≤1个心跳周期（默认心跳周期1分钟）

2.系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常

**备注**：


### 反复建立连接和断开连接
---
**用例编号**：AOS-3-26

**用例名称**：反复建立连接和断开连接

**测试目的**：验证设备反复建立连接和断开连接的稳定性

**用例属性**：稳定性

**测试步骤**：

1.设备认证连接，并保持在线状态（维持心跳）

2.5分钟后断开网络（断AP WAN口）

3.5分钟后恢复网络（恢复AP WAN口连接）

4.重复步骤2~3 100次

**预期结果**：

1.设备上线次数100次，离线次数100次

2.系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常

**备注**：

自测重复10次即可

<!-- 
<a id='wsf'></a>
## WSF 通道测试规范

### 设备注册与登录

| 测试用例编号 | AOS-3-1                                                                                                                                                              |
|--------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 设备注册与登录                                                                                                                                                       |
| 测试目的     | 验证设备是否支持注册、登录逻辑                                                                                                                                       |
| 测试属性     | 必选 \| P0 \| 功能用例                                                                                                                                               |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                                                                               |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                                                                                   |
| 测试预置条件 | 设备联网                                                                                                                                                             |
| 测试步骤     | 设备注册、登录成功并保持在线状态                                                                                                                                   |
| 预期结果     | \- 注册成功、登录成功 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常                                                                               |
| 备注         | \- alink1.0 注册接口： registerDevice； <br>- alink1.1 注册接口： device.registerByAuthToken。 <br>- alink1.0 登录接口： LoginDevice； <br>- alink1.1 登录接口： device.login |

### 设备UUID持久化

| 测试用例编号 | AOS-3-2                                                                                                                              |
|--------------|--------------------------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 设备UUID持久化                                                                                                                       |
| 测试目的     | 验证设备注册后持久化存储UUID，在断开连接、上电重启后不再注册                                                                         |
| 测试属性     | 必选 \| P0 \| 功能用例                                                                                                               |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                                               |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                                                   |
| 测试预置条件 | \- 设备联网                                                                                                                          |
| 测试步骤     | \- 设备连接，并保持在线状态 <br>- 断开网络使设备离线 <br>- 恢复网络使设备上线 <br>- 设备掉电重启，网络保持正常使设备上线                      |
| 预期结果     | \- 断网后设备连线重连不出现注册行为 <br>- 设备掉电重启后不出现注册行为 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常 |
| 备注         |                                                                                                                                      |

### 设备响应下行命令及上报状态

| 测试用例编号 | AOS-3-3                                                                                                      |
|--------------|--------------------------------------------------------------------------------------------------------------|
| 测试用例     | 设备响应下行命令及上报状态                                                                                   |
| 测试目的     | 验证设备是否能正常响应云平台的下行命令， 并上报设备状态                                                      |
| 测试属性     | 必选 \| P0 \| 功能用例                                                                                       |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                       |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                           |
| 测试预置条件 | 设备联网                                                                                                     |
| 测试步骤     | \- 设备连接，并保持在线状态 <br>- 设备模拟上报数据 <br>- 通过APP或者web下行控制设备命令                            |
| 预期结果     | \- 设备正确上报状态 <br>- 设备正确响应下行命令 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常 |
| 备注         |                                                                                                              |

### 设备主动上报状态

| 测试用例编号 | AOS-3-4                                                                                                           |
|--------------|-------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 设备主动上报状态                                                                                                  |
| 测试目的     | 验证设备是否支持主动上报设备状态，上电后第一次上报是否支持上报完整的状态                                          |
| 测试属性     | 必选 \| P0 \| 功能用例                                                                                            |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                            |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                                |
| 测试预置条件 | 设备联网                                                                                                          |
| 测试步骤     | \- 设备上电等待连接成功后，查看设备上报数据 <br>- 断网后恢复连接后，查看设备上报数据 <br>- 重新联网后，查看设备上报数据 |
| 预期结果     | \- 步骤1\~3设备上报所有属性值 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常                    |
| 备注         |                                                                                                                   |

### 设备恢复出厂设置

| 测试用例编号 | AOS-3-5                                                                                                      |
|--------------|--------------------------------------------------------------------------------------------------------------|
| 测试用例     | 设备恢复出厂设置                                                                                             |
| 测试目的     | 设备原厂恢复功能                                                                                             |
| 测试属性     | 可选 \| P0 \| 功能用例                                                                                       |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                       |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                           |
| 测试预置条件 | \- 设备联网                                                                                                  |
| 测试步骤     | \- 设备上电，连接成功并保持心跳 <br>- 对设备进行硬件或软件恢复出厂设置 <br>- 设备上电重连，查看设备与账号绑定关系  |
| 预期结果     | \- 设备恢复出厂设置，账号与设备绑定关系解除 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常 |
| 备注         |                                                                                                              |

### 设备透传

| 测试用例编号 | AOS-3-6                                                                                                            |
|--------------|--------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 设备透传                                                                                                           |
| 测试目的     | 验证设备是否支持指令透传模式                                                                                       |
| 测试属性     | 可选 \| P0 \| 功能用例                                                                                             |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                             |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                                 |
| 测试预置条件 | \- 设备联网                                                                                                        |
| 测试步骤     | <br>- 设备上电，连接成功并保持心跳 <br>- 设备模拟上报二进制数据 <br>- APP或web模拟发送数据到设备端                          |
| 预期结果     | \- 设备成功上报二进制数据也能接收到接收到模拟数据 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常 |
| 备注         |                                                                                                                    |

### 设备上报状态时延

| 测试用例编号 | AOS-3-7                                                                                                                                   |
|--------------|-------------------------------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 设备上报状态时延                                                                                                                          |
| 测试目的     | 验证设备功能或状态发生改变时，及时上报变更后的属性数据到服务 端，如：用户通过 APP 调节空调温度，调节成功后，温度值应该即时 上报到服务端。 |
| 测试属性     | 必选 \| P0 \| 功能用例                                                                                                                    |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                                                    |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                                                        |
| 测试预置条件 | \- 设备联网                                                                                                                               |
| 测试步骤     | \- 设备上电，连接成功并保持心跳 <br>- 通过APP下发控制命令改变设备属性值，查看 log，确认设备从收到控制指令到上报该属性到服务端时长            |
| 预期结果     | \- 设备从收到控制指令到上报属性到服务端时延≤1s <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常                           |
| 备注         |                                                                                                                                           |

### 低频指令测试

| 测试用例编号 | AOS-3-8                                                                                                            |
|--------------|--------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 低频指令测试                                                                                                       |
| 测试目的     | 验证设备低频通信稳定性                                                                                             |
| 测试属性     | 必选 \| P0 \| 稳定性用例                                                                                           |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                             |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                                 |
| 测试预置条件 | \- 设备联网                                                                                                        |
| 测试步骤     | \- 设备连接，并保持在线状态 <br>- 使用压测工具以500ms为周期向设备发送消息                                             |
| 预期结果     | \- 12小时稳定工作，无断线 <br>- 指令响应成功率≥99.9% <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常 |
| 备注         | 压测工具及使用见 “AliOS Things认证指南”                                                                            |

### 高频指令测试

| 测试用例编号 | AOS-3-9                                                                                                          |
|--------------|------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 高频指令测试                                                                                                     |
| 测试目的     | 验证设备高频通信稳定性                                                                                           |
| 测试属性     | 可选 \| P0 \| 稳定性用例                                                                                         |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                           |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                               |
| 测试预置条件 | \- 设备联网                                                                                                      |
| 测试步骤     | \- 设备连接，并保持在线状态 <br>- 使用压测工具以200ms为周期向设备发送消息                                           |
| 预期结果     | \- 12小时稳定工作，无断线 <br>- 指令响应成功率≥98% <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常 |
| 备注         | 压测工具及使用见 “AliOS Things认证指南”                                                                          |

### 长时间稳定工作

| 测试用例编号 | AOS-3-10                                                                                                                   |
|--------------|----------------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 长时间稳定工作                                                                                                             |
| 测试目的     | 验证设备ALink长时间稳定工作                                                                                                |
| 测试属性     | 必选 \| P0 \| 稳定性用例                                                                                                   |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                                     |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                                         |
| 测试预置条件 | 设备联网                                                                                                                   |
| 测试步骤     | 设备认证连接，在线保持心跳                                                                                                 |
| 预期结果     | \- 5x24小时稳定工作 <br>- 离线次数＜4次 <br>- 单次离线时间≤60秒 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常 |
| 备注         | 压测工具及使用见 “AliOS Things认证指南”                                                                                    |

### 长时间断网后恢复连接能力

| 测试用例编号 | AOS-3-11                                                                                                         |
|--------------|------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 长时间断网后恢复连接能力                                                                                         |
| 测试目的     | 验证设备ALink长时间断网后自动恢复连接的能力                                                                      |
| 测试属性     | 必选 \| P0 \| 稳定性用例                                                                                         |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                           |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                               |
| 测试预置条件 | 设备联网                                                                                                         |
| 测试步骤     | \- 设备认证连接，在线保持心跳 <br>- 稳定后断开网络连接（AP断电） <br>- 12小时后AP上电                                  |
| 预期结果     | \- 检测到网络断开 <br>- 网络恢复后自动恢复连接能力 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常 |
| 备注         |                                                                                                                  |

### 长时间断网后恢复业务能力

| 测试用例编号 | AOS-3-12                                                                                                                                            |
|--------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 长时间断网后恢复业务能力                                                                                                                            |
| 测试目的     | 验证设备ALink长时间断网后自动恢复连接的能力                                                                                                         |
| 测试属性     | 必选 \| P0 \| 稳定性用例                                                                                                                            |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                                                              |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                                                                  |
| 测试预置条件 | 设备联网                                                                                                                                            |
| 测试步骤     | \- 设备认证连接，在线保持心跳 <br>- 稳定后断开网络连接（断开AP端WAN网络） <br>- 12小时后后恢复网络（连接AP端WAN网络） <br>- 恢复连接后使用在线工具下发数据包 |
| 预期结果     | \- 检测到网络断开 <br>- 网络恢复后自动恢复连接能力 <br>- 网络恢复后能正常收发数据包 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常      |
| 备注         |                                                                                                                                                     |

### 支持无缝切换AP能力

| 测试用例编号 | AOS-3-13                                                                                                                                   |
|--------------|--------------------------------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 支持无缝切换AP能力                                                                                                                         |
| 测试目的     | 验证更改AP后，在SSID与无线密码不变的情况，自动恢复连接能力                                                                                 |
| 测试属性     | 必选 \| P1 \| 功能用例                                                                                                                     |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                                                     |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                                                         |
| 测试预置条件 | 设备联网                                                                                                                                   |
| 测试步骤     | \- 手机连接AP1网络，联网设备，此时设备连接到AP1 <br>- 关闭AP1电源，此时设备出现断网状态，然后接通AP2（无线SSID与无线密钥，与AP1保持一致）电源 |
| 预期结果     | \- 检测到网络断开 <br>- 设备连接到AP2并重连保持在线状态 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常                      |
| 备注         |                                                                                                                                            |

### 超长数据包接收处理能力

| 测试用例编号 | AOS-3-14                                                                                                                                              |
|--------------|-------------------------------------------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 超长数据包接收处理能力                                                                                                                                |
| 测试目的     | 验证设备处理超长数据包接收能力                                                                                            |
| 测试属性     | 必选 \| P1 \| 功能用例                                                                                                                                |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                                                                |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                                                                    |
| 测试预置条件 | 设备联网并连接物联平台                                                                                                                                |
| 测试步骤     | \- 模拟APP发送有效业务数据包(payload≥2000字节，连续发送10个)到设备端 <br>- 模拟APP发送有效业务数据包（payload=1000字节），设备端响应成功、主动上报状态。 |
| 预期结果     | \- 系统成功接收并处理2000字节或者1000字节 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常                                            |
| 备注         |                                                                                                                                                       |

### 设备上电到联网成功时长

| 测试用例编号 | AOS-3-15                                                                            |
|--------------|-------------------------------------------------------------------------------------|
| 测试用例     | 设备上电到联网成功时长                                                              |
| 测试目的     | 验证设备从上电启动，到连接物联平台所耗时长，启动时间长短影响用户体验。              |
| 测试属性     | 必选 \| P1 \| 功能用例                                                              |
| 测试设备     | 1.设备，2.串口线，3.PC                                                              |
| 测试拓扑结构 | 一个设备串口连接PC，设备连接AP                                                      |
| 测试预置条件 | 设备联网并连接物联平台                                                              |
| 测试步骤     | \- 切断设备电源，再接通电源开始计时为A； <br>- 确认设备重启并成功连接物联平台的时间为B |
| 预期结果     | \- B-A≤15秒 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常        |
| 备注         |                                                                                     |

<a id="coap"></a>
## CoAP 通道测试规范

### 设备认证

| 测试用例编号 | AOS-3-28                                                                                                                                 |
|--------------|------------------------------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 设备认证                                                                                                                                 |
| 测试目的     | 验证设备认证后获取iotid与iottoken                                                                                                        |
| 测试属性     | 必选 \| P0 \| 功能用例                                                                                                                   |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                                                   |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                                                       |
| 测试预置条件 | 设备联网成功                                                                                                                             |
| 测试步骤     | \- 设备尝试通过HTTPS认证 <br>- 设备连接CoAP服务器                                                                                           |
| 预期结果     | \-设备所支持的认证方式认证通过，拿到iotid和iottoken并且成功连接CoAP服务器 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异 |
| 备注         | CoAP支持HTTPS认证                                                                                                                        |

### 设备消息上行

| 测试用例编号 | AOS-3-29                                                                                                                           |
|--------------|------------------------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 设备消息上行                                                                                                                       |
| 测试目的     | 验证设备CoAP上行消息                                                                                                               |
| 测试属性     | 必选 \| P0 \| 功能用例                                                                                                             |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                                             |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                                                 |
| 测试预置条件 | \- 设备联网成功 <br>- 设备认证成功                                                                                                    |
| 测试步骤     | 设备向topic A发送消息                                                                                                              |
| 预期结果     | \- 设备发布消息成功，服务日志查询的消息内容与设备发布的消息内容相同 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异 |
| 备注         | CoAP只支持上行                                                                                                                     |

### 设备反复认证

| 测试用例编号 | AOS-3-30                                                                             |
|--------------|--------------------------------------------------------------------------------------|
| 测试用例     | 设备反复认证                                                                         |
| 测试目的     | 验证设备反复认证稳定性                                                               |
| 测试属性     | 必选 \| P0 \| 稳定性用例                                                             |
| 测试设备     | 1.设备，2.串口线，3.PC                                                               |
| 测试拓扑结构 | 一个设备串口连接PC                                                                   |
| 测试预置条件 | 设备联网                                                                             |
| 测试步骤     | \- 设备认证 <br>- 设备向topic A发送消息 <br>- 步骤1\~2重复1W次                             |
| 预期结果     | \- 认证成功率≥99.9% <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常 |
| 备注         |                                                                                      |

### 低频CON消息

| 测试用例编号 | AOS-3-31                                                                                                        |
|--------------|-----------------------------------------------------------------------------------------------------------------|
| 测试用例     | 低频CON消息                                                                                                     |
| 测试目的     | 验证设备低频通信稳定性                                                                                          |
| 测试属性     | 必选 \| P0 \| 稳定性用例                                                                                        |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                          |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                              |
| 测试预置条件 | 设备联网                                                                                                        |
| 测试步骤     | \- 设备认证通过 <br>- 设备以500ms为周期向topic A发送消息 <br>- 使用工具统计topic A消息数量                            |
| 预期结果     | \- 24小时稳定工作 <br>- 丢包率≤1% <br>- 重连次数≤5次 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常 |
| 备注         |                                                                                                                 |

###  长时间稳定通信

| 测试用例编号 | AOS-3-32                                                                                                            |
|--------------|---------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 长时间稳定通信                                                                                                      |
| 测试目的     | 验证设备CoAP大数据包稳定通信                                                                                        |
| 测试属性     | 必选 \| P0 \| 稳定性用例                                                                                            |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                              |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                                  |
| 测试预置条件 | 设备联网                                                                                                            |
| 测试步骤     | \- 设备认证成功 <br>- 设备以300s的周期向topic A发布消息 <br>- 使用工具统计topic A消息数量                                 |
| 预期结果     | \- 5x24小时稳定工作 <br>- 丢包率≤0.1% <br>- 重连次数≤3次 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常 |
| 备注         |                                                                                                                     |

### 大数据包稳定通信

| 测试用例编号 | AOS-3-33                                                                                                         |
|--------------|------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 大数据包稳定通信                                                                                                 |
| 测试目的     | 验证设备大数据包稳定通信                                                                                         |
| 测试属性     | 必选 \| P0 \| 稳定性用例                                                                                         |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                           |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                               |
| 测试预置条件 | 设备联网                                                                                                         |
| 测试步骤     | \- 设备认证成功 <br>- 设备以500ms为周期向topic A发送2000字节的消息 <br>- 使用工具统计topic A消息数量                   |
| 预期结果     | \- 1小时稳定工作 <br>- 丢包率≤0.5% <br>- 重连次数≤1次 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常 |
| 备注         | 2000字节可以根据设备实际能力调整                                                                                 | -->
