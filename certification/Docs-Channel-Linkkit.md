# AliOS Things LinkKit 通道测试规范
* [AOS-3-34 设备认证及连接](#设备认证及连接)
* [AOS-3-35 设置设备属性](#设置设备属性)
* [AOS-3-36 获取设备属性](#获取设备属性)
* [AOS-3-37 设备服务调用](#设备服务调用)
* [AOS-3-38 设备事件上报](#设备事件上报)
* [AOS-3-39 设备心跳](#设备心跳)
* [AOS-3-40 长时间数据通信稳定性](#长时间数据通信稳定性)
* [AOS-3-41 大数据包通信稳定性](#大数据包通信稳定性)
* [AOS-3-42 断网发现](#断网发现)
* [AOS-3-43 长时间断网后重连](#长时间断网后重连)
* [AOS-3-44 反复建立连接和断开连接](#反复建立连接和断开连接)


### 设备认证及连接
---
**用例编号**：AOS-3-34

**用例名称**：设备认证及连接

**测试目的**：验证设备通过身份认证并成功连接到阿里云Link物联网平台

**用例属性**：功能

**测试步骤**：

1.将设备三元组烧录至待测设备

2.设备上电，通过命令行或者APP连上路由器（WiFi设备）

3.登录一站式开发平台，查看设备在线状态

**预期结果**：

1.设备串口日志显示连接成功

2.一站式开发平台显示设备在线

3.系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常

**备注**：

1.命令行配网：# netmgr connect {SSID} {PASSWD}

2.服务端相关操作详见[LinkKit通道测试指南](Manual-Channel-LinkKit)


### 设置设备属性
---
**用例编号**：AOS-3-35

**用例名称**：设置设备属性

**测试目的**：验证设备能够接收服务端设置属性命令

**用例属性**：功能

**测试步骤**：

1.在阿里云一站式开发平台`调试设备`页面`设置`设备属性，属性的数据类型需要覆盖整型、浮点型、布尔型、字符串、枚举、时间类型、JSON

2.观察设备串口日志，确定是否接收到该属性设置

3.观察`调试设备`页面，确实是否显示设备下行和设备上行日志

**预期结果**：

1.设备串口日志显示接收到属性设置，且属性值正确

2.6中数据类型的属性全部支持

3.`调试设备`页面显示设备下行和设备上行日志，日志中属性设置值正确

4.设备响应时长 < 1s

5.系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常

**备注**：

1.设备响应时长计算：在`调试设备`页面观察设备下行和设备上行日志，结合日志时间戳计算响应时长

2.服务端相关操作详见[LinkKit通道测试指南](Manual-Channel-LinkKit)


### 获取设备属性
---
**用例编号**：AOS-3-36

**用例名称**：获取设备属性

**测试目的**：验证能获取设备属性值

**用例属性**：功能

**测试步骤**：

1.在阿里云一站式开发平台`调试设备`页面`获取`设备属性，属性的数据类型需要覆盖整型、浮点型、布尔型、字符串、枚举、时间类型、JSON

2.观察`调试设备`页面，观察返回的设备属性JSON

**预期结果**：

1.`调试设备`页面返回正确的设备属性值

2.6中数据类型的属性全部支持

3.系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常

**备注**：服务端相关操作详见[LinkKit通道测试指南](Manual-Channel-LinkKit)


### 设备服务调用
---
**用例编号**：AOS-3-37

**用例名称**：设备服务调用

**测试目的**：验证设备响应服务端的服务调用

**用例属性**：功能

**测试步骤**：

1.在阿里云一站式开发平台`调试设备`页面，输入服务的输入参数，调用服务

2.观察设备串口日志，确定是否接收到该服务调用

3.在`设备详情`->`服务调用`页面查看服务调用记录

**预期结果**：

1.设备串口显示接收到服务调用，且输入参数符合预期

2.服务调用记录显示服务调用成功

3.设备响应时长 < 1s

4.系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常

**备注**：

1.设备响应时长计算：在`调试设备`页面观察设备下行日志和服务调用记录时间戳计算响应时长

2.服务端相关操作详见[LinkKit通道测试指南](Manual-Channel-LinkKit)


### 设备事件上报
---
**用例编号**：AOS-3-38

**用例名称**：设备事件上报

**测试目的**：验证设备支持主动上报事件

**用例属性**：功能

**测试步骤**：

1.物理按键或者软件模拟，触发事件

2.`设备详情`->`事件管理`页面查看设备事件管理

**预期结果**：

1.设备事件管理列表显示最近一次事件调用

2.事件上报时长 < 1s

3.系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常

**备注**：

1.事件上报时长计算：设备端日志时间戳与服务端时间管理列表时间戳之差

2.服务端相关操作详见[LinkKit通道测试指南](Manual-Channel-LinkKit)


### 设备心跳
---
**用例编号**：AOS-3-39

**用例名称**：设备心跳

**测试目的**：验证设备保持在线心跳机制完备

**用例属性**：功能

**测试步骤**：

1.设备以心跳为周期向MQTT服务器发送心跳包持续3小时

2.观察云端设备在线状态

**预期结果**：

1.设备3小时无离线

2.系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常

**备注**：


### 长时间数据通信稳定性
---
**用例编号**：AOS-3-40

**用例名称**：长时间连接稳定性

**测试目的**：验证物联网设备与阿里云长时间连接且数据通信稳定

**用例属性**：稳定性

**测试步骤**：

1.设备上电，使用串口工具将设备串口日志定向到文件

2.web页面上确定设备上线，记录设备上线时间

3.使用压测工具以200ms为周期设置设备属性，保持设备网络环境稳定

**预期结果**：

1.3x24小时稳定工作，无离线 

2.成功率≥99.5% 

3.系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常

**备注**：
1.服务端相关操作详见[LinkKit通道测试指南](Manual-Channel-LinkKit)

2.压测工具暂未上线，自测压测时请联系阿里小二



### 大数据包通信稳定性
---
**用例编号**：AOS-3-41

**用例名称**：大数据包通信稳定

**测试目的**：验证设备在数据量较大情况下能长时间稳定通信

**用例属性**：必选 | 稳定性

**预置条件**：设备连接至阿里云Link物联网平台

**测试步骤**：

1.设备上电，页面上确认设备上线，静置 1 小时

2.使用串口工具将设备串口日志定向到文件

3.使用压测工具向该设备发送字符串类型数据，字符串长度为256字节，发送周期为500ms

4.1小时后查看压测工具，检查设备离线次数、丢包率

5.系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常

**预期结果**：

1.压测期间无离线

2.成功率100%

**备注**：

1.服务端相关操作详见[LinkKit通道测试指南](Manual-Channel-LinkKit)

2.压测工具暂未上线，自测压测时请联系阿里小二


### 断网发现
---
**用例编号**：AOS-3-42

**用例名称**：断网发现

**测试目的**：验证设备在网络断开后能发现网络异常

**用例属性**：稳定性

**测试步骤**：

1.设备认证连接，并保持在线状态（维持心跳）

2.待连接稳定后，断开网络（断AP WAN口）

3.查看设备端日志

**预期结果**：

1.网络断开后设备能发现并断开连接

2.发现断网时间≤3个心跳周期（默认心跳周期为1分钟） 

**备注**：


### 长时间断网后重连
---
**用例编号**：AOS-3-43

**用例名称**：长时间断网后重连

**测试目的**：验证设备在断开连接后能恢复连接

**用例属性**：稳定性

**测试步骤**：

1.设备认证连接，并保持在线状态（维持心跳）

2.待连接稳定后，断开网络（断AP WAN口）

3.1小时后恢复网络（恢复AP WAN口连接）

4.观察设备上线记录

**预期结果**：

1.网络恢复后设备能够再次上线，时间间隔≤1个心跳周期（默认心跳周期1分钟）

2.系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常

**备注**：


### 反复建立连接和断开连接
---
**用例编号**：AOS-3-44

**用例名称**：反复建立连接和断开连接

**测试目的**：验证设备反复建立连接和断开连接的稳定性

**用例属性**：稳定性

**测试步骤**：

1.设备认证连接，并保持在线状态（维持心跳）

2.5分钟后断开网络（断AP WAN口）

3.5分钟后恢复网络（恢复AP WAN口连接）

4.重复步骤2~3 100次

**预期结果**：

1.设备上线次数100次，离线次数100次

2.系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常

**备注**：

1.自测重复10次即可